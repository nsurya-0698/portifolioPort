"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core");function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var r=n(e),a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},a.apply(this,arguments)},i=function(e){var n=e.getPageIndex,a=e.renderSpinner,i=e.doc,u=r.useState(""),c=u[0],o=u[1],l=r.useRef();return r.useEffect((function(){var e=l.current;if(e){var r=i.numPages,a=n?n({numPages:r}):0,u=Math.max(0,Math.min(a,r-1));t.getPage(i,u).then((function(t){var n=t.getViewport({scale:1}),r=n.width,a=n.height,i=document.createElement("canvas"),u=i.getContext("2d",{alpha:!1}),c=e.clientWidth,l=e.clientHeight,s=Math.min(c/r,l/a),g=s*r,d=s*a;i.height=d,i.width=g,i.style.opacity="0";var h=t.getViewport({rotation:0,scale:s});t.render({canvasContext:u,viewport:h}).promise.then((function(){return o(i.toDataURL())}),(function(){}))}))}}),[]),c?r.createElement("img",{className:"rpv-thumbnail__cover-image","data-testid":"thumbnail__cover-image",src:c}):r.createElement("div",{className:"rpv-thumbnail__cover-loader",ref:l},a?a():r.createElement(t.Spinner,null))},u=function(e){var n=e.getPageIndex,a=e.renderSpinner,u=e.store,c=r.useState(),o=c[0],l=c[1],s=function(e){l(e)};return r.useEffect((function(){return u.subscribe("doc",s),function(){u.unsubscribe("doc",s)}}),[]),r.createElement("div",{className:"rpv-thumbnail__cover"},o?r.createElement(i,{doc:o,getPageIndex:n,renderSpinner:a}):r.createElement("div",{className:"rpv-thumbnail__cover-loader"},a?a():r.createElement(t.Spinner,null)))},c=function(){return r.createElement(t.Spinner,null)},o=r.createContext({renderSpinner:c}),l=function(e){var n=e.page,a=e.pageHeight,i=e.pageIndex,u=e.pageWidth,c=e.rotation,l=e.thumbnailHeight,s=e.thumbnailWidth,g=r.useContext(t.LocalizationContext).l10n,d=r.useRef(),h=r.useState(""),p=h[0],f=h[1],m=g&&g.thumbnail?g.thumbnail.thumbnailLabel:"Thumbnail of page {{pageIndex}}";return r.useEffect((function(){var e=d.current;e&&e.cancel();var t=document.createElement("canvas"),r=t.getContext("2d",{alpha:!1}),i=s,o=i/(u/a),l=i/u;t.height=o,t.width=i,t.style.height="".concat(o,"px"),t.style.width="".concat(i,"px");var g=n.getViewport({rotation:c,scale:l});d.current=n.render({canvasContext:r,viewport:g}),d.current.promise.then((function(){return f(t.toDataURL())}),(function(){}))}),[c]),p?r.createElement("img",{"aria-label":m.replace("{{pageIndex}}","".concat(i+1)),src:p,height:"".concat(l,"px"),width:"".concat(s,"px")}):r.useContext(o).renderSpinner()},s=function(e){var n=e.doc,a=e.isActive,i=e.pageHeight,u=e.pageIndex,c=e.pageWidth,s=e.rotation,g=e.onActive,d=r.useState({height:i,isCalculated:!1,page:null,viewportRotation:0,width:c}),h=d[0],p=d[1],f=r.useRef({isVisible:!1,ratio:0}),m=h.isCalculated,b=h.page,v=h.height,x=h.width,P=x/v,_=Math.abs(s)%180==0,E=_?100:100/P,w=_?100/P:100;r.useLayoutEffect((function(){if(a){var e=f.current;(!e.isVisible||e.ratio<1)&&g(u)}}),[a]);var S=(s+h.viewportRotation)%360,C=t.useIntersectionObserver({onVisibilityChanged:function(e){f.current=e,e.isVisible&&!m&&t.getPage(n,u).then((function(e){var t=e.getViewport({scale:1});p({height:t.height,isCalculated:!0,page:e,viewportRotation:t.rotation,width:t.width})}))}});return r.createElement("div",{className:"rpv-thumbnail__container",ref:C,style:{height:"".concat(w,"px"),width:"".concat(E,"px")}},b?r.createElement(l,{page:b,pageHeight:_?v:x,pageIndex:u,pageWidth:_?x:v,rotation:S,thumbnailHeight:w,thumbnailWidth:E}):r.useContext(o).renderSpinner())},g=function(e){var n=e.currentPage,a=e.doc,i=e.labels,u=e.pageHeight,c=e.pageWidth,o=e.renderCurrentPageLabel,l=e.renderThumbnailItem,g=e.rotation,d=e.onJumpToPage,h=a.numPages,p=i.length,f=r.useRef(null),m=r.useRef([]),b=r.useState(n),v=b[0],x=b[1],P=r.useContext(t.ThemeContext).direction===t.TextDirection.RightToLeft,_=function(e){var t=f.current;if(t){var n=t.children;e<n.length&&function(e,t){var n=e.getBoundingClientRect().top-t.getBoundingClientRect().top,r=e.clientHeight,a=t.clientHeight;n<0?t.scrollTop+=n:n+r<=a||(t.scrollTop+=n+r-a)}(n.item(e),t)}},E=function(){if(f.current){var e=m.current,t=v+1;t<e.length&&(v>=0&&e[v].setAttribute("tabindex","-1"),x(t))}},w=function(){if(f.current){var e=m.current,t=v-1;t>=0&&(v>=0&&e[v].setAttribute("tabindex","-1"),x(t))}},S=function(){v>=0&&v<h&&d(v)};return t.useIsomorphicLayoutEffect((function(){var e=f.current;e&&(m.current=Array.from(e.querySelectorAll(".rpv-thumbnail__item")))}),[]),r.useEffect((function(){var e=m.current;if(!(0===e.length||v<0||v>e.length)){var t=e[v];t.setAttribute("tabindex","0"),t.focus()}}),[v]),r.createElement("div",{ref:f,"data-testid":"thumbnail__list",className:t.classNames({"rpv-thumbnail__list":!0,"rpv-thumbnail__list--rtl":P}),onKeyDown:function(e){switch(e.key){case"ArrowDown":E();break;case"ArrowUp":w();break;case"Enter":S()}}},Array(h).fill(0).map((function(e,f){var m="".concat(a.loadingTask.docId,"___").concat(f),b=p===h?i[f]:"".concat(f+1),v=o?o({currentPage:n,pageIndex:f,numPages:h,pageLabel:b}):b,x=r.createElement(s,{doc:a,isActive:n===f,pageHeight:u,pageIndex:f,pageWidth:c,rotation:g,onActive:_});return l?l({currentPage:n,key:m,numPages:h,pageIndex:f,renderPageLabel:r.createElement(r.Fragment,null,v),renderPageThumbnail:x,onJumpToPage:function(){return d(f)}}):r.createElement("div",{key:m},r.createElement("div",{className:t.classNames({"rpv-thumbnail__item":!0,"rpv-thumbnail__item--selected":n===f}),role:"button",tabIndex:n===f?0:-1,onClick:function(){return d(f)}},x),r.createElement("div",{className:"rpv-thumbnail__index"},v))})))},d=function(e){var n=e.renderCurrentPageLabel,a=e.renderThumbnailItem,i=e.store,u=function(e){var t=r.useState([]),n=t[0],a=t[1],i=function(e){e.getPageLabels().then((function(e){a(e||[])}))};return r.useEffect((function(){return e.subscribe("doc",i),function(){a([]),e.unsubscribe("doc",i)}}),[]),n}(i),c=r.useState(i.get("doc")),l=c[0],s=c[1],d=r.useState(i.get("currentPage")||0),h=d[0],p=d[1],f=r.useState(i.get("pageHeight")||0),m=f[0],b=f[1],v=r.useState(i.get("pageWidth")||0),x=v[0],P=v[1],_=r.useState(i.get("rotation")||0),E=_[0],w=_[1],S=function(e){p(e)},C=function(e){s(e)},y=function(e){b(e)},I=function(e){P(e)},T=function(e){w(e)};return r.useEffect((function(){return i.subscribe("doc",C),i.subscribe("pageHeight",y),i.subscribe("pageWidth",I),i.subscribe("rotation",T),function(){i.unsubscribe("doc",C),i.unsubscribe("pageHeight",y),i.unsubscribe("pageWidth",I),i.unsubscribe("rotation",T)}}),[]),t.useIsomorphicLayoutEffect((function(){return i.subscribe("currentPage",S),function(){i.unsubscribe("currentPage",S)}}),[]),l?r.createElement(g,{currentPage:h,doc:l,labels:u,pageHeight:m,pageWidth:x,renderCurrentPageLabel:n,renderThumbnailItem:a,rotation:E,onJumpToPage:function(e){var t=i.get("jumpToPage");t&&t(e)}}):r.createElement("div",{"data-testid":"thumbnail-list__loader",className:"rpv-thumbnail__loader"},r.useContext(o).renderSpinner())};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */exports.thumbnailPlugin=function(e){var n=r.useMemo((function(){return t.createStore({})}),[]);return{install:function(e){n.update("jumpToPage",e.jumpToPage)},onDocumentLoad:function(e){n.update("doc",e.doc)},onViewerStateChange:function(e){return n.update("currentPage",e.pageIndex),n.update("pageHeight",e.pageHeight),n.update("pageWidth",e.pageWidth),e},Cover:function(t){return r.createElement(u,a({},t,{renderSpinner:null==e?void 0:e.renderSpinner,store:n}))},Thumbnails:r.useCallback((function(t){return r.createElement(o.Provider,{value:{renderSpinner:(null==e?void 0:e.renderSpinner)||c}},r.createElement(d,{renderCurrentPageLabel:null==e?void 0:e.renderCurrentPageLabel,renderThumbnailItem:null==t?void 0:t.renderThumbnailItem,store:n}))}),[])}};
